(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{405:function(t,s,a){t.exports=a.p+"assets/img/2.57722a63.png"},558:function(t,s,a){t.exports=a.p+"assets/img/1.5ea43d8d.png"},559:function(t,s,a){t.exports=a.p+"assets/img/step1.93e6df80.jpg"},560:function(t,s,a){t.exports=a.p+"assets/img/step2.b506cd4c.jpg"},561:function(t,s,a){t.exports=a.p+"assets/img/step3.176fefcc.jpg"},562:function(t,s,a){t.exports=a.p+"assets/img/step4.991b62ea.jpg"},669:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"阿里云-云服务器-ecs-centos7-0安装nginx教程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阿里云-云服务器-ecs-centos7-0安装nginx教程"}},[t._v("#")]),t._v(" 阿里云 云服务器 ECS CentOS7.0安装Nginx教程")]),t._v(" "),n("p",[n("a",{attrs:{href:"http://nginx.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx"),n("OutboundLink")],1),t._v("是一个高性能的HTTP和反向代理服务，许多的大型网站都会采用Nginx来进行HTTP服务器托管，当然我们这里也要采用Nginx，在安装Nginx之前，需要安装一些前置模块")]),t._v(" "),n("h2",{attrs:{id:"准备环境及安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备环境及安装"}},[t._v("#")]),t._v(" 准备环境及安装")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("关于Linux拓展补充")]),t._v(" "),n("p",[t._v("/opt：是用户级的程序目录，可以理解为D:/Software。安装到/opt目录下的程序，它所有的数据、库文件等等都是放在同个目录下面。opt有可选的意思，这里可以用于放置第三方大型软件（或游戏），当你不需要时，直接rm -rf掉即可。在硬盘容量不够时，也可将/opt单独挂载到其他磁盘上使用。 "),n("br"),t._v("\n/usr：系统级的目录，可以理解为C:/Windows/。"),n("br"),t._v("\n/usr/lib：理解为C:/Windows/System32。"),n("br"),t._v("\n/usr/local：用户级的程序目录，可以理解为C:/Progrem Files/。用户自己编译的软件默认会安装到这个目录下。"),n("br"),t._v("\n这里主要存放那些手动安装的软件，即不是通过“新立得”或apt-get安装的软件。它和/usr目录具有相类似的目录结构。让软件包管理器来管理/usr目录，而把自定义的脚本(scripts)放到/usr/local目录下面。"),n("br")])]),t._v(" "),n("h3",{attrs:{id:"阿里云centos安装nginx所需环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阿里云centos安装nginx所需环境"}},[t._v("#")]),t._v(" 阿里云CentOS安装Nginx所需环境")]),t._v(" "),n("h5",{attrs:{id:"安装编译环境gcc-g"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装编译环境gcc-g"}},[t._v("#")]),t._v(" 安装编译环境gcc g++")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入到root目录")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/\nyum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" zlib zlib-devel gcc-c++ libtool  openssl openssl-devel\n")])])]),n("h5",{attrs:{id:"安装pcre-pcre功能是让nginx有rewrite功能-下载pcre"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装pcre-pcre功能是让nginx有rewrite功能-下载pcre"}},[t._v("#")]),t._v(" 安装PCRE: PCRE功能是让nginx有rewrite功能，下载PCRE")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz\n")])])]),n("h5",{attrs:{id:"解压pcre安装包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解压pcre安装包"}},[t._v("#")]),t._v(" 解压PCRE安装包")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" zxvf pcre-8.35.tar.gz\n")])])]),n("h5",{attrs:{id:"安装pcre"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装pcre"}},[t._v("#")]),t._v(" 安装PCRE")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入安装包目录")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" pcre-8.35 \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译      ")]),t._v("\n./configure \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装     ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),n("br"),t._v(" "),n("br"),t._v(" "),n("h3",{attrs:{id:"阿里云centos开始安装nignx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阿里云centos开始安装nignx"}},[t._v("#")]),t._v(" 阿里云CentOS开始安装Nignx")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 回到root目录：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 载nginx安装包")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" http://nginx.org/download/nginx-1.16.0.tar.gz\n")])])]),n("h5",{attrs:{id:"解压安装包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解压安装包"}},[t._v("#")]),t._v(" 解压安装包")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" zxvf nginx-1.16.0.tar.gz\n")])])]),n("blockquote",[n("p",[t._v("注意，这里要选好当前解压地址，解压完成就是Nginx所在的目录，这里我们在root根目录下解压。 进入安装目录：")])]),t._v(" "),n("h5",{attrs:{id:"编译-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译-安装"}},[t._v("#")]),t._v(" 编译 安装")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入nginx-1.16.0.tar.gz 解压后的文件 nginx-1.16.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" nginx-1.16.0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译")]),t._v("\n./configure  --prefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx/ --with-http_stub_status_module  --with-http_ssl_module\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),n("blockquote",[n("p",[n("code",[t._v("编译时不写入 --prefix=/usr/local/nginx 则意味着Nginx会安装到/usr/local/nginx下面 |||| 你可以指定到安装到/root目录下./configure --prefix=/root/nginx")])])]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("已安装NGINX  首次安装编译Nginx时如果没有添加 --with-http_ssl_module  意味着不能使用https   如何不重新装NGINX操作如下")]),t._v(" "),n("p",[n("strong",[t._v("环境：已安装NGINX")]),t._v("。")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入到解压后的nginx安装文件下内")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v("  /root/nginx-1.16.0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新编译 ")]),t._v("\n./configure  --with-http_stub_status_module --with-http_ssl_module\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装  切记不要 make install 否则会导致覆盖之前的nginx")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#备份")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拷贝 (make完之后在objs目录下就多了个nginx，这个就是新版本的程序了)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -r objs/nginx /usr/local/nginx/sbin/nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启")]),t._v("\n/usr/local/nginx/sbin/nginx -s reload\n")])])])]),t._v(" "),n("h5",{attrs:{id:"启动和停止nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动和停止nginx"}},[t._v("#")]),t._v(" 启动和停止Nginx")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sbin"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s stop\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sbin"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s reload\n")])])]),n("div",{staticClass:"custom-block danger"},[n("p",{staticClass:"custom-block-title"},[t._v('首次开启Nginx 报错 /usr/local/Nginx/logs/Nginx.pid" failed(2:No such file or directory)')]),t._v(" "),n("p",[n("strong",[t._v("/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf")]),t._v(" "),n("br"),t._v(" "),n("code",[t._v("使用nginx -c的参数指定nginx.conf文件的位置")])])]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v('如果在修改Nginx参数后 运行时报错 (Found a swap file by the name ".nginx.conf.swp")')]),t._v(" "),n("blockquote",[n("p",[t._v("那就是因为上次vim的时候，没有完全退出中途产生中断了。解决问题的方式很简单，就是把这个后缀swp的文件删掉就可以了**** "),n("br")])]),t._v(" "),n("p",[n("code",[t._v("cd /usr/local/nginx/sbin/nginx")])]),t._v(" "),n("p",[t._v("命令显示出所有文件  (因为 .swp 暂存文件是隐藏文件) "),n("br"),t._v(" "),n("code",[t._v("ls -a")])]),t._v(" "),n("p",[t._v("执行删除"),n("br"),t._v(" "),n("code",[t._v("rm -f .nginx.conf.swp")])]),t._v(" "),n("p",[t._v("然后重启服务"),n("br"),t._v(" "),n("code",[t._v("/usr/local/nginx/sbin/nginx -s reload")])])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("常用Nginx指令")]),t._v(" "),n("p",[n("code",[t._v("重新载入配置文件")]),t._v("              /usr/local/nginx/sbin/nginx -s reload   "),n("br"),t._v(" "),n("code",[t._v("重启 Nginx")]),t._v("                 /usr/local/nginx/sbin/nginx -s reopen   "),n("br"),t._v(" "),n("code",[t._v("停止 Nginx")]),t._v("                 /usr/local/nginx/sbin/nginx -s stop    "),n("br"),t._v(" "),n("code",[t._v("查看ngixn版本极其编译参数")]),t._v("   /usr/local/nginx/sbin/nginx -V   "),n("br"),t._v(" "),n("code",[t._v("检查配置文件nginx.conf的正确性命令")]),t._v(" /usr/local/nginx/sbin/nginx -t")])]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h3",{attrs:{id:"window如何安装nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#window如何安装nginx"}},[t._v("#")]),t._v(" Window如何安装Nginx")]),t._v(" "),n("ul",[n("li",[t._v("到"),n("code",[t._v("nginx")]),t._v("官网下载"),n("code",[t._v("window")]),t._v("版压缩包（作者使用的是"),n("code",[t._v("nginx-1.14.2")]),t._v("）")])]),t._v(" "),n("blockquote",[n("p",[t._v("http://nginx.org/en/download.html")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("在任意位置解压"),n("code",[t._v("nginx")]),t._v("压缩包")])]),t._v(" "),n("li",[n("p",[t._v("进入"),n("code",[t._v("nginx")]),t._v("根目录，并在"),n("code",[t._v("html")]),t._v("目录下新建一个文件夹"),n("code",[t._v("admin")]),t._v("文件夹")])]),t._v(" "),n("li",[n("p",[t._v("回到"),n("code",[t._v("nginx")]),t._v("根目录，并进入到"),n("code",[t._v("conf")]),t._v("目录下，找到"),n("code",[t._v("nginx.conf")]),t._v("并打开")])]),t._v(" "),n("li",[n("p",[t._v("找到"),n("code",[t._v("http")]),t._v("域并另起一行，加入如下代码：")])])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("sever "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name xxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("#"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("您的域名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    root html"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("admin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\ttry_files $uri $uri"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tindex index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[t._v("回到"),n("code",[t._v("nginx")]),t._v("根目录，双击"),n("code",[t._v("nginx.exe")]),t._v("运行"),n("code",[t._v("nginx")])])]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"http及https的有关配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http及https的有关配置"}},[t._v("#")]),t._v(" Http及Https的有关配置")]),t._v(" "),n("h4",{attrs:{id:"访问本机文件夹的nginx的配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问本机文件夹的nginx的配置"}},[t._v("#")]),t._v(" 访问本机文件夹的Nginx的配置")]),t._v(" "),n("p",[t._v("通过Nginx配置实现根据不同的客户端访问不同的文件比如H5和PC 并且支持vue静态页面的"),n("code",[t._v("history路由模式")])]),t._v(" "),n("blockquote",[n("p",[t._v("通过自定义变量实现访问不同的文件夹资源 "),n("code",[t._v("$terminaltype")]),t._v("  &  "),n("code",[t._v("root $terminaltype")]),t._v(" "),n("br"),t._v("\n通过配置 "),n("code",[t._v("try_files")]),t._v("  可以实现vue静态文件支持history路由模式访问")])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 访问文件的配置")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  www.xmanv.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$terminaltype")]),t._v(" html/web-client/pc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v(" ~ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Android"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("iPhone"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("iPod"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("BlackBerry"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("WindowsPhone"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("UC"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Kindle"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Mobile"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("webOS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$terminaltype")]),t._v(" html/web-client/wap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            add_header Access-Control-Allow-Origin  *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            add_header Access-Control-Allow-Credentials  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            add_header Access-Control-Allow-Methods  *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            root "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$terminaltype")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index index.html index.htm index.php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            try_files "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v("/ /index.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[n("code",[t._v("try_files")]),t._v("按配置顺序检查文件是否存在，返回第一个找到的文件。结尾的斜线表示为文件夹 -$uri/。如果所有的文件都找不到，会进行一个内部重定向到最后一个参数。")])]),t._v(" "),n("h4",{attrs:{id:"代理本机其他接口的配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代理本机其他接口的配置"}},[t._v("#")]),t._v(" 代理本机其他接口的配置")]),t._v(" "),n("blockquote",[n("p",[t._v("通过配置  "),n("code",[t._v("proxy_pass")]),t._v("  实现接口的反向代理")])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 代理本机其他接口的配置")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  api.xmanv.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location ~ /^"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("H,h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("T,t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("T,t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("P,p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("S,s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            proxy_pass http://127.0.0.1:5614"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            proxy_set_header Host                           "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            proxy_set_header X-Real-IP                      "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            proxy_set_header X-Forwarded-For                "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认情况")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            proxy_pass http://127.0.0.1:5614"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            proxy_set_header Host                           "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            proxy_set_header X-Real-IP                      "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            proxy_set_header X-Forwarded-For                "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认情况")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h4",{attrs:{id:"配置https支持网站https访问-同时强制用户访问http是跳到https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置https支持网站https访问-同时强制用户访问http是跳到https"}},[t._v("#")]),t._v(" 配置Https支持网站https访问 同时强制用户访问http是跳到https")]),t._v(" "),n("blockquote",[n("p",[t._v("通过配置  "),n("code",[t._v("rewrite ^(.*) https://$server_name$1 permanent;")]),t._v("  实现重定向 "),n("a",{attrs:{href:"https://www.cnblogs.com/redfire/p/7695627.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("其他方法"),n("OutboundLink")],1)])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 代理本机其他接口的配置")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name  www.xmanv.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$terminaltype")]),t._v(" html/web-client/pc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v(" ~ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Android"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("iPhone"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("iPod"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("BlackBerry"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("WindowsPhone"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("UC"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Kindle"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Mobile"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("webOS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$terminaltype")]),t._v(" html/web-client/wap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    add_header Access-Control-Allow-Credentials  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add_header Access-Control-Allow-Methods  *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    root "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$terminaltype")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    index index.html index.htm index.php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    try_files "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v("/ /index.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ssl_certificate      /root/.acme.sh/xmanv.com/fullchain.cer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#证书地址")]),t._v("\n    ssl_certificate_key  /root/.acme.sh/xmanv.com/xmanv.com.key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#秘钥地址")]),t._v("\n    ssl_session_cache    shared:SSL:1m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    ssl_stapling_verify on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    resolver "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.8")]),t._v(".8.8 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.8")]),t._v(".4.4 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("valid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("60s "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ipv6")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    resolver_timeout 5s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    error_page   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server_name  www.xmanv.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rewrite ^"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(".*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" https://"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$server_name")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" permanent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[n("RouterLink",{attrs:{to:"/backend/https.html#安装acme-sh脚本"}},[t._v("免费Https证书获取教程")])],1)]),t._v(" "),n("h2",{attrs:{id:"nginx配置301重定向"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置301重定向"}},[t._v("#")]),t._v(" Nginx配置301重定向")]),t._v(" "),n("blockquote",[n("p",[t._v("本文讲解 nginx 如何配置重定向跳转。重定向分为 301 永久重定向和 302 临时重定向，本文主要讲解 301 永久重定向。"),n("br"),t._v("\n网站在实际运营中，很可能会有重定向的需求, 如非 www 域名自动重定向为 www 域名, http 地址自动重定向为 https 地址等。"),n("br"),t._v("\n当网站的域名做变更时，通过 301 重定向还可以将旧域名的分数排名转移到新域名。"),n("br")])]),t._v(" "),n("h3",{attrs:{id:"http-重定向到-https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-重定向到-https"}},[t._v("#")]),t._v(" http 重定向到 https")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 将"http的www域名"重定向到"https的www域名"')]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#http端口")]),t._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    server_name  www.sofineday.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log /var/log/nginx/www.sofineday.com.access_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    error_log /var/log/nginx/www.sofineday.com.error_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://www.sofineday.com"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置https的www域名")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#https端口")]),t._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    server_name  www.sofineday.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log /var/log/nginx/www.sofineday.com.access_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    error_log /var/log/nginx/www.sofineday.com.error_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#https的证书配置")]),t._v("\n    ssl_certificate    /etc/nginx/cert/_.sofineday.com.full_chain.pem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_certificate_key    /etc/nginx/cert/_.sofineday.com.private.key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    root /static-file/blog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("h3",{attrs:{id:"主域名重定向到-www-域名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主域名重定向到-www-域名"}},[t._v("#")]),t._v(" 主域名重定向到 www 域名")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 将"http的主域名"重定向到"http的www域名"')]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#http端口")]),t._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    server_name  sofineday.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log /var/log/nginx/sofineday.com.access_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    error_log /var/log/nginx/sofineday.com.error_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" http://www.sofineday.com"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 将"http的www域名"重定向到"https的www域名"')]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#http端口")]),t._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    server_name  www.sofineday.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log /var/log/nginx/www.sofineday.com.access_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    error_log /var/log/nginx/www.sofineday.com.error_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    root /static-file/blog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("h3",{attrs:{id:"将-主域名或-http-域名-都重定向到-https-的-www-域名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#将-主域名或-http-域名-都重定向到-https-的-www-域名"}},[t._v("#")]),t._v(' 将"主域名或 http 域名"都重定向到 https 的 www 域名')]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[t._v("推荐该方案，终极方案，考虑得最完善！ 做 seo 优化时，需要考虑该方案，详见seo 重定向")])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 将"http或https的主域名"重定向到"https的www域名"')]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#http端口")]),t._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#https端口")]),t._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    server_name  sofineday.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log /var/log/nginx/sofineday.com.access_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    error_log /var/log/nginx/sofineday.com.error_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#https的证书配置")]),t._v("\n    ssl_certificate    /etc/nginx/cert/_.sofineday.com.full_chain.pem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_certificate_key    /etc/nginx/cert/_.sofineday.com.private.key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://www.sofineday.com"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 将"http的www域名"重定向到"https的www域名"')]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#http端口")]),t._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    server_name  www.sofineday.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log /var/log/nginx/www.sofineday.com.access_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    error_log /var/log/nginx/www.sofineday.com.error_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://www.sofineday.com"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置https的www域名")]),t._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#https端口")]),t._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    server_name  www.sofineday.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    access_log /var/log/nginx/www.sofineday.com.access_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    error_log /var/log/nginx/www.sofineday.com.error_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#https的证书配置")]),t._v("\n    ssl_certificate    /etc/nginx/cert/_.sofineday.com.full_chain.pem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_certificate_key    /etc/nginx/cert/_.sofineday.com.private.key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    root /static-file/blog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"nginx配置gzip压缩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置gzip压缩"}},[t._v("#")]),t._v(" Nginx配置gzip压缩")]),t._v(" "),n("br"),t._v(" "),n("blockquote",[n("p",[t._v("本文讲述 nginx 支持 gzip 压缩的配置方法。大文件的访问不仅会浪费服务端的带宽流量，也会浪费用户端的带宽流量，并且还会影响传输速度，从而影响用户体验。"),n("br"),t._v("\n所以对于大文件，应该采用 gzip 压缩，减少文件传输大小、减少带宽占用、提高文件加载速度、提升用户体验。")])]),t._v(" "),n("ul",[n("li",[t._v("打开"),n("code",[t._v("nginx.conf")]),t._v("，并在"),n("code",[t._v("http")]),t._v("模块任意行加入如下代码： 在 "),n("code",[t._v("http")]),t._v(","),n("code",[t._v("server")]),t._v(" 或 "),n("code",[t._v("location")]),t._v(" 任意模块都可以配置 "),n("code",[t._v("gzip")]),t._v(" 压缩。")])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v("  on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gizp压缩起点，文件大于1k才进行压缩")]),t._v("\ngzip_min_length 1k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gzip 压缩级别，1-9，数字越大压缩的越好，也越占用CPU时间")]),t._v("\ngzip_comp_level "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进行压缩的文件类型, 按需补充即可")]),t._v("\ngzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否在http header中添加Vary: Accept-Encoding，建议开启")]),t._v("\ngzip_vary on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),n("ul",[n("li",[t._v("保存并重启"),n("code",[t._v("nginx")])])]),t._v(" "),n("p",[n("code",[t._v("window")]),t._v("与"),n("code",[t._v("linux")]),t._v("的配置方式完全一致，只需要找到"),n("code",[t._v("nginx.conf")]),t._v("配置文件进行如上操作即可")]),t._v(" "),n("h2",{attrs:{id:"nginx封禁ip或ip段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx封禁ip或ip段"}},[t._v("#")]),t._v(" nginx封禁IP或IP段")]),t._v(" "),n("blockquote",[n("p",[t._v("本文讲述 nginx 封禁 IP 或 IP 段的配置方法。若发现我们的网站被某个 IP 频繁非正常访问或被某个 IP 段频繁访问, 那么很可能是爬虫的 IP，我们需要根据实际分析来决定是否要封禁这些 IP，这样这些 IP 就无法访问我们的网站进而无法爬取我们的资源。")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("使用 deny 指令封禁 IP, 可以在如下区域配置:"),n("br"),t._v("\nhttp、server 或 location")])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#封禁单个 IP")]),t._v("\ndeny "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123.45")]),t._v(".6.7\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#封整个段即从 123.0.0.1 到 123.255.255.254")]),t._v("\ndeny "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123.0")]),t._v(".0.0/8\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#封 IP 段即从 123.45.0.1 到 123.45.255.254 的命令")]),t._v("\ndeny "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("124.45")]),t._v(".0.0/16\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#封 IP 段即从 123.45.6.1 到 123.45.6.254")]),t._v("\ndeny "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123.45")]),t._v(".6.0/24\n")])])]),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"开启ocspstapling优化https访问性能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开启ocspstapling优化https访问性能"}},[t._v("#")]),t._v(" 开启OCSPStapling优化https访问性能")]),t._v(" "),n("blockquote",[n("p",[t._v("本文讲述 nginx 开启 OCSP Stapling 的配置方法, 从而优化 https 的访问性能。因为免费证书的证书校验服务器可能没有国内节点，导致国内用户通过 https 访问站点可能会明显比 http 慢。nginx 开启 OCSP Stapling 即可解决该问题。")])]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("https 站点访问慢的原因分析")]),t._v(" "),n("p",[t._v("因为浏览器访问 https 站点时，至少首次访问会去证书校验服务器检验 https 证书, 但是免费证书的校验服务器一般都在国外，导致国内用户访问的时候，会明显感到慢，甚至经常出现网络错误。")]),t._v(" "),n("p",[t._v("不同的客户端设备的 https 证书校验机制又不尽相同。例如 android 设备会在首次访问 https 站点时，把证书缓存在本地，后续访问就不会去访问校验服务，导致 android 上访问很流畅，但是 ios 设备却体验特别差，甚至压根没法用。")]),t._v(" "),n("p",[t._v("为了解决免费 https 证书访问慢的问题，有个解决方案："),n("code",[t._v("OCSP Stapling")]),t._v("。")])]),t._v(" "),n("h3",{attrs:{id:"检查证书是否已开启-ocsp-stapling"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#检查证书是否已开启-ocsp-stapling"}},[t._v("#")]),t._v(" 检查证书是否已开启 OCSP Stapling")]),t._v(" "),n("ul",[n("li",[t._v("检查证书是否已开启 OCSP Stapling")])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("openssl s_client -connect sofineday.com:443 -servername sofineday.com -status -tlsextdebug "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" /dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OCSP"')]),t._v("\n")])])]),n("ul",[n("li",[t._v("若显示如下结果，则表示已开启")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("OCSP response:\nOCSP Response Data:\n    OCSP Response Status: successful (0x0)\n    Response Type: Basic OCSP Response\n\n")])])]),n("ul",[n("li",[t._v("若显示如下结果，则表示未开启")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("OCSP response: no response sent\n")])])]),n("ul",[n("li",[t._v("前往 "),n("a",{attrs:{href:"https://myssl.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("myssl.com"),n("OutboundLink")],1),t._v(" 网站 查看")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(558),alt:"开启后台启动"}})]),t._v(" "),n("ul",[n("li",[n("p",[t._v("若没有开启 ocsp, 显示如下 "),n("br"),t._v(" "),n("img",{attrs:{src:a(405),alt:"开启后台启动"}})])]),t._v(" "),n("li",[n("p",[t._v("若已开启 ocsp，显示如下 "),n("br"),t._v(" "),n("img",{attrs:{src:a(405),alt:"开启后台启动"}})])])]),t._v(" "),n("h3",{attrs:{id:"开启-nginx-的-ocsp-stapling-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开启-nginx-的-ocsp-stapling-配置"}},[t._v("#")]),t._v(" 开启 nginx 的 OCSP Stapling 配置")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("此处只给了 Let's Encrypt 证书的 oscp 配置")]),t._v(" "),n("p",[t._v("若您使用的是其它品牌的证书，配置方法不同，请自行查找教程。")])]),t._v(" "),n("blockquote",[n("p",[t._v("在原有的 https 配置基础之上，加入如下 4 行配置即可")])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("ssl_stapling on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nssl_stapling_verify on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresolver "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.8")]),t._v(".8.8 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.8")]),t._v(".4.4 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("valid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("60s "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ipv6")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresolver_timeout 5s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h2",{attrs:{id:"负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[t._v("#")]),t._v(" 负载均衡")]),t._v(" "),n("blockquote",[n("p",[t._v("有效处理服务器高并发，同时也适用于平滑部署")])]),t._v(" "),n("ul",[n("li",[t._v("打开"),n("code",[t._v("nginx.conf")]),t._v("，并在"),n("code",[t._v("http")]),t._v("模块任意行加入如下代码：")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("upstream xuanzai {\n\tserver xxx.com weight=10; # 服务器1\n\tserver xxx.com weight=10; # 服务器2\n}\n")])])]),n("ul",[n("li",[t._v("配置"),n("code",[t._v("server")]),t._v("模块")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tlisten "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tserver_name xzadmin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xuanzai"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" # 暴露给用户访问的域名\n\tlocation "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tproxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("xuanzai"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" # 名称与负载均衡配置的名称一致\n\t\tproxy_redirect "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tindex index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\t\n\t\troot html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[t._v("保存并重启"),n("code",[t._v("nginx")])])]),t._v(" "),n("p",[t._v("这样，简单的负载均衡就配置完成了！"),n("br"),t._v("\n此时如果两个（或多个）服务器已开启，那么可尝试访问已配置好的域名，查看是否配置成功"),n("br"),t._v(" "),n("code",[t._v("window")]),t._v("与"),n("code",[t._v("linux")]),t._v("的配置方式完全一致，只需要找到"),n("code",[t._v("nginx.conf")]),t._v("配置文件进行如上操作即可")]),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"修改阿里云组策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改阿里云组策略"}},[t._v("#")]),t._v(" 修改阿里云组策略")]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),n("p",[t._v("注意，在开启nginx的http和https服务后，需要在阿里云的云服务器实例安全组策略中添加80端口和443端口的开启。")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("如果要使用其他端口都需要在安全组里进行配置(一个阿里云账号下的多台esc服务器 都是配在同一个地方)")])]),t._v(" "),n("p",[n("strong",[t._v("找到实例中的安全组配置：")]),t._v(" "),n("br"),t._v(" "),n("img",{attrs:{src:a(559),alt:"vuepress首页效果"}})]),t._v(" "),n("p",[n("strong",[t._v("进入之后，点击添加安全组配置：")]),t._v(" "),n("br"),t._v(" "),n("img",{attrs:{src:a(560),alt:"vuepress首页效果"}})]),t._v(" "),n("p",[n("strong",[t._v("添加http的80端口：")]),t._v(" "),n("br"),t._v(" "),n("img",{attrs:{src:a(561),alt:"vuepress首页效果"}})]),t._v(" "),n("p",[n("strong",[t._v("添加https的443端口：")]),t._v(" "),n("br"),t._v(" "),n("img",{attrs:{src:a(562),alt:"vuepress首页效果"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);