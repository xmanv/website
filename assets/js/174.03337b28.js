(window.webpackJsonp=window.webpackJsonp||[]).push([[174],{849:function(a,e,t){"use strict";t.r(e);var s=t(1),n=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"centos-安装-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#centos-安装-docker"}},[a._v("#")]),a._v(" CentOS 安装 Docker")]),a._v(" "),t("blockquote",[t("p",[a._v("警告：切勿在没有配置 Docker YUM 源的情况下直接使用 yum 命令安装 Docker.")])]),a._v(" "),t("h2",{attrs:{id:"准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[a._v("#")]),a._v(" 准备工作")]),a._v(" "),t("h3",{attrs:{id:"系统要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#系统要求"}},[a._v("#")]),a._v(" 系统要求")]),a._v(" "),t("p",[a._v("Docker CE 支持 64 位版本 CentOS 7，并且要求内核版本不低于 3.10。 CentOS 7 满足最低内核的要求，但由于内核版本比较低，部分功能（如 "),t("code",[a._v("overlay2")]),a._v(" 存储层驱动）无法使用，并且部分功能可能不太稳定。")]),a._v(" "),t("h3",{attrs:{id:"卸载旧版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#卸载旧版本"}},[a._v("#")]),a._v(" 卸载旧版本")]),a._v(" "),t("p",[a._v("旧版本的 Docker 称为 "),t("code",[a._v("docker")]),a._v(" 或者 "),t("code",[a._v("docker-engine")]),a._v("，使用以下命令卸载旧版本：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum remove docker "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n                  docker-client "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n                  docker-client-latest "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n                  docker-common "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n                  docker-latest "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n                  docker-latest-logrotate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n                  docker-logrotate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n                  docker-selinux "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n                  docker-engine-selinux "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n                  docker-engine\n")])])]),t("h2",{attrs:{id:"使用-yum-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-yum-安装"}},[a._v("#")]),a._v(" 使用 yum 安装")]),a._v(" "),t("p",[a._v("执行以下命令安装依赖包：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -y yum-utils "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n           device-mapper-persistent-data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n           lvm2\n")])])]),t("p",[a._v("鉴于国内网络问题，强烈建议使用国内源，官方源请在注释中查看。")]),a._v(" "),t("p",[a._v("执行下面的命令添加 "),t("code",[a._v("yum")]),a._v(" 软件源：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum-config-manager "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --add-repo "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 官方源")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# $ sudo yum-config-manager \\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#     --add-repo \\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#     https://download.docker.com/linux/centos/docker-ce.repo    ")]),a._v("\n")])])]),t("p",[a._v("如果需要最新版本的 Docker CE 请使用以下命令：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum-config-manager --enable docker-ce-edge\n")])])]),t("p",[a._v("如果需要测试版本的 Docker CE 请使用以下命令：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum-config-manager --enable docker-ce-test\n")])])]),t("h3",{attrs:{id:"安装-docker-ce"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker-ce"}},[a._v("#")]),a._v(" 安装 Docker CE")]),a._v(" "),t("p",[a._v("更新 "),t("code",[a._v("yum")]),a._v(" 软件源缓存，并安装 "),t("code",[a._v("docker-ce")]),a._v("。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum makecache fast\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-ce\n")])])]),t("h2",{attrs:{id:"使用脚本自动安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用脚本自动安装"}},[a._v("#")]),a._v(" 使用脚本自动安装")]),a._v(" "),t("p",[a._v("在测试或开发环境中 Docker 官方为了简化安装流程，提供了一套便捷的安装脚本，CentOS 系统上可以使用这套脚本安装：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -fsSL get.docker.com -o get-docker.sh\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" get-docker.sh --mirror Aliyun\n")])])]),t("p",[a._v("执行这个命令后，脚本就会自动的将一切准备工作做好，并且把 Docker CE 的 Edge 版本安装在系统中。")]),a._v(" "),t("h2",{attrs:{id:"启动-docker-ce"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动-docker-ce"}},[a._v("#")]),a._v(" 启动 Docker CE")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" docker\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl start docker\n")])])]),t("h2",{attrs:{id:"建立-docker-用户组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#建立-docker-用户组"}},[a._v("#")]),a._v(" 建立 docker 用户组")]),a._v(" "),t("p",[a._v("默认情况下，"),t("code",[a._v("docker")]),a._v(" 命令会使用 "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Unix_domain_socket",target:"_blank",rel:"noopener noreferrer"}},[a._v("Unix socket"),t("OutboundLink")],1),a._v(" 与 Docker 引擎通讯。而只有 "),t("code",[a._v("root")]),a._v(" 用户和 "),t("code",[a._v("docker")]),a._v(" 组的用户才可以访问 Docker 引擎的 Unix socket。出于安全考虑，一般 Linux 系统上不会直接使用 "),t("code",[a._v("root")]),a._v(" 用户。因此，更好地做法是将需要使用 "),t("code",[a._v("docker")]),a._v(" 的用户加入 "),t("code",[a._v("docker")]),a._v(" 用户组。")]),a._v(" "),t("p",[a._v("建立 "),t("code",[a._v("docker")]),a._v(" 组：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("groupadd")]),a._v(" docker\n")])])]),t("p",[a._v("将当前用户加入 "),t("code",[a._v("docker")]),a._v(" 组：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" -aG docker "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$USER")]),a._v("\n")])])]),t("p",[a._v("退出当前终端并重新登录，进行如下测试。")]),a._v(" "),t("h2",{attrs:{id:"测试-docker-是否安装正确"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-docker-是否安装正确"}},[a._v("#")]),a._v(" 测试 Docker 是否安装正确")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker run hello-world\n\nUnable to "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" image "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'hello-world:latest'")]),a._v(" locally\nlatest: Pulling from library/hello-world\nca4f61b1923c: Pull complete\nDigest: sha256:be0cd392e45be79ffeffa6b05338b98ebb16c87b255f48e297ec7f98e123905c\nStatus: Downloaded newer image "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" hello-world:latest\n\nHello from Docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\nThis message shows that your installation appears to be working correctly.\n\nTo generate this message, Docker took the following steps:\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(". The Docker client contacted the Docker daemon.\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(". The Docker daemon pulled the "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hello-world"')]),a._v(" image from the Docker Hub.\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(". The Docker daemon created a new container from that image "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("which")]),a._v(" runs the\n    executable that produces the output you are currently reading.\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(". The Docker daemon streamed that output to the Docker client, "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("which")]),a._v(" sent it\n    to your terminal.\n\nTo try something "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" ambitious, you can run an Ubuntu container with:\n $ docker run -it ubuntu "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n\nShare images, automate workflows, and "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" with a "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("free")]),a._v(" Docker ID:\n https://cloud.docker.com/\n\nFor "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" examples and ideas, visit:\n https://docs.docker.com/engine/userguide/\n")])])]),t("p",[a._v("若能正常输出以上信息，则说明安装成功。")]),a._v(" "),t("h2",{attrs:{id:"镜像加速"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像加速"}},[a._v("#")]),a._v(" 镜像加速")]),a._v(" "),t("p",[a._v("鉴于国内网络问题，后续拉取 Docker 镜像十分缓慢，强烈建议安装 Docker 之后配置 "),t("code",[a._v("国内镜像加速")]),a._v("。")]),a._v(" "),t("h2",{attrs:{id:"添加内核参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加内核参数"}},[a._v("#")]),a._v(" 添加内核参数")]),a._v(" "),t("p",[a._v("默认配置下，如果在 CentOS 使用 Docker CE 看到下面的这些警告信息：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("WARNING: bridge-nf-call-iptables is disabled\nWARNING: bridge-nf-call-ip6tables is disabled\n")])])]),t("p",[a._v("请添加内核配置参数以启用这些功能。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" -a /etc/sysctl.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<-")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF")]),a._v("\n")])])]),t("p",[a._v("然后重新加载 "),t("code",[a._v("sysctl.conf")]),a._v(" 即可")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" sysctl -p\n")])])]),t("h2",{attrs:{id:"参考文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[a._v("#")]),a._v(" 参考文档")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/installation/linux/docker-ce/centos/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Docker 官方 CentOS 安装文档"),t("OutboundLink")],1),a._v("。")])])])}),[],!1,null,null,null);e.default=n.exports}}]);