(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{883:function(s,t,e){"use strict";e.r(t);var a=e(1),r=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"redis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" Redis")]),s._v(" "),e("h2",{attrs:{id:"零、redis是什么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#零、redis是什么"}},[s._v("#")]),s._v(" 零、redis是什么")]),s._v(" "),e("p",[s._v("redis是什么，是一种非关系型数据库，统称nosql。")]),s._v(" "),e("h2",{attrs:{id:"一、redis与memcached比较"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、redis与memcached比较"}},[s._v("#")]),s._v(" 一、redis与memcached比较")]),s._v(" "),e("ul",[e("li",[s._v("1、redis受益于“持久化”可以做存储(storge)，memcached只能做缓存(cache)")]),s._v(" "),e("li",[s._v("2、redis有多种数据结构，memcached只有一种类型"),e("code",[s._v("字符串(string)")])])]),s._v(" "),e("h2",{attrs:{id:"二、安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、安装"}},[s._v("#")]),s._v(" 二、安装")]),s._v(" "),e("p",[s._v("安装最新稳定版")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 源码安装redis-4.0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://download.redis.io/releases/redis-4.0.1.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxvf redis-4.0.1.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis-4.0.1\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n错误：You need tcl "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.5")]),s._v(" or newer "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" order to run the Redis "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n解决：yum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" tcl\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" utils\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 赋予运行权限")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x install_server.sh\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行脚本")]),s._v("\n./install_server.sh\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置")]),s._v("\nPort           "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\nConfig "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" /etc/redis/redis.conf\nLog "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" /var/log/redis.log\nData "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" /var/lib/redis/redis\nExecutable     "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" /usr/local/bin/redis-server\nCli Executable "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" /usr/local/bin/redis-cli\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自启动")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" redis_6379 on\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/redis/redis.conf\nrequirepass Root666,./\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" redis_6379 restart\n")])])]),e("h2",{attrs:{id:"三、配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、配置"}},[s._v("#")]),s._v(" 三、配置")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("redis-benchmark     redis性能测试工具\nredis-check-aof     检查aof日志的工具\nredis-check-rdb     检查rdb日志的工具\nredis-cli           连接用的客户端\nredis-server        服务进程\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置文件启动 这样会霸占终端")]),s._v("\n/usr/local/bin/redis-server /etc/redis/redis.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改为不霸占终端")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/redis/redis.conf\ndaemonize no  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis 默认有16个数据库，默认使用0号数据库，可使用select、move等命令操作")]),s._v("\ndatabases "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n")])])]),e("h2",{attrs:{id:"四、通用key操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、通用key操作"}},[s._v("#")]),s._v(" 四、通用key操作")]),s._v(" "),e("ol",[e("li",[s._v("keys 查询")])]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("在redis里,允许模糊查询key\n有3个通配符 - ? "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n-: 通配任意多个字符\n?: 通配单个字符\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": 通配括号内的某1个字符\n\n")])])]),e("ol",[e("li",[s._v("keys 查询")]),s._v(" "),e("li",[s._v("del 删除")]),s._v(" "),e("li",[s._v("rename 重命名")]),s._v(" "),e("li",[s._v("move 移到另外一个库")]),s._v(" "),e("li",[s._v("randomkey 随机")]),s._v(" "),e("li",[s._v("exists 存在")]),s._v(" "),e("li",[s._v("type 类型")]),s._v(" "),e("li",[s._v("ttl 剩余生命周期")]),s._v(" "),e("li",[s._v("expire 设置生命周期")]),s._v(" "),e("li",[s._v("persist 永久有效")]),s._v(" "),e("li",[s._v("flushdb 清空")])]),s._v(" "),e("h2",{attrs:{id:"五、redis中的5中数据结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、redis中的5中数据结构"}},[s._v("#")]),s._v(" 五、redis中的5中数据结构")]),s._v(" "),e("h3",{attrs:{id:"_1-字符串-string"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-字符串-string"}},[s._v("#")]),s._v(" 1. 字符串（string）")]),s._v(" "),e("ul",[e("li",[s._v("set\n"),e("ul",[e("li",[s._v("set name shengj -> OK")])])]),s._v(" "),e("li",[s._v("get\n"),e("ul",[e("li",[s._v('get name -> "shengj"')])])]),s._v(" "),e("li",[s._v("del\n"),e("ul",[e("li",[s._v("del name -> (integer) 1")]),s._v(" "),e("li",[s._v("get name -> (nil)")])])]),s._v(" "),e("li",[s._v("mset\n"),e("ul",[e("li",[s._v("mset name shengj age 23 sex male -> OK")])])]),s._v(" "),e("li",[s._v("mget\n"),e("ul",[e("li",[s._v("mget age sex"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"23"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"male"')]),s._v("\n")])])])])])]),s._v(" "),e("li",[s._v("setrange\n"),e("ul",[e("li",[s._v("setrange sex 2 1 将sex的第3个字符改成1 -> (integer) 4")]),s._v(" "),e("li",[s._v('get sex -> "ma1e"')])])]),s._v(" "),e("li",[s._v("append\n"),e("ul",[e("li",[s._v("append name GG -> (integer) 8")]),s._v(" "),e("li",[s._v('get name -> "shengjGG"')])])]),s._v(" "),e("li",[s._v("getrange\n"),e("ul",[e("li",[s._v('getrange name 1 2 -> "he"')])])]),s._v(" "),e("li",[s._v("incr 自增")]),s._v(" "),e("li",[s._v("incrby 自增一个量级")]),s._v(" "),e("li",[s._v("incrbyfloat 自增一个浮点数")]),s._v(" "),e("li",[s._v("decr 递减")]),s._v(" "),e("li",[s._v("decrby 递减一个量级")]),s._v(" "),e("li",[s._v("decrbyfloat 递减一个浮点数")]),s._v(" "),e("li",[s._v("setbit 设置二进制位数")]),s._v(" "),e("li",[s._v("getbit 获取二进制表示")]),s._v(" "),e("li",[s._v("bitop 位操作")])]),s._v(" "),e("hr"),s._v(" "),e("h3",{attrs:{id:"_2-列表-list-链表支持-有序-可重复"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-列表-list-链表支持-有序-可重复"}},[s._v("#")]),s._v(" 2. 列表（list）链表支持 有序 可重复")]),s._v(" "),e("ul",[e("li",[s._v("rpush 右边插入\n"),e("ul",[e("li",[s._v("rpush list item1 -> (integer) 1")]),s._v(" "),e("li",[s._v("rpush list item2 -> (integer) 2")]),s._v(" "),e("li",[s._v("rpush list item3 -> (integer) 3")])])]),s._v(" "),e("li",[s._v("lrange 列出链表值\n"),e("ul",[e("li",[s._v("lrange list 0 -1"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item2"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item3"')]),s._v("\n")])])])])])]),s._v(" "),e("li",[s._v("lindex\n"),e("ul",[e("li",[s._v('lindex list 1 -> "item2"')])])]),s._v(" "),e("li",[s._v("lpop\n"),e("ul",[e("li",[s._v('lpop list -> "item1"')]),s._v(" "),e("li",[s._v("lrange list 0 -1"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item2"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item3"')]),s._v("\n")])])])])])]),s._v(" "),e("li",[s._v("ltrim\n"),e("ul",[e("li",[s._v("ltrim list 3 0 -> OK")]),s._v(" "),e("li",[s._v("lrange list 0 -1 -> (empty list or set)")])])]),s._v(" "),e("li",[s._v("lpush 左边插入")]),s._v(" "),e("li",[s._v("rpop 右边删除")]),s._v(" "),e("li",[s._v("lrem")])]),s._v(" "),e("hr"),s._v(" "),e("h3",{attrs:{id:"_3-集合-set-无序-不可重复"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-集合-set-无序-不可重复"}},[s._v("#")]),s._v(" 3. 集合（set）无序 不可重复")]),s._v(" "),e("ul",[e("li",[s._v("sadd 增加\n"),e("ul",[e("li",[s._v("sadd set item1 -> (integer) 1")]),s._v(" "),e("li",[s._v("sadd set item2 -> (integer) 1")]),s._v(" "),e("li",[s._v("sadd set item3 -> (integer) 1")]),s._v(" "),e("li",[s._v("sadd set item1 -> (integer) 0  已存在")])])]),s._v(" "),e("li",[s._v("smembers 所有集合元素\n"),e("ul",[e("li",[s._v("smembers set"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item3"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item2"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item1"')]),s._v("\n")])])])])])]),s._v(" "),e("li",[s._v("sismember 存不存在\n"),e("ul",[e("li",[s._v("sismember set item1 -> (integer) 1")]),s._v(" "),e("li",[s._v("sismember set item -> (integer) 0 不存在")])])]),s._v(" "),e("li",[s._v("srem 移除元素\n"),e("ul",[e("li",[s._v("srem set item1 -> (integer) 1")]),s._v(" "),e("li",[s._v("smembers set"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item3"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item2"')]),s._v("\n")])])])])])]),s._v(" "),e("li",[s._v("spop 随机删除一个元素")]),s._v(" "),e("li",[s._v("srandmember 随机获取一个元素 -> 抽奖")]),s._v(" "),e("li",[s._v("scard 多少个元素")]),s._v(" "),e("li",[s._v("smove 移动")]),s._v(" "),e("li",[s._v("sinter 交集")]),s._v(" "),e("li",[s._v("sinterstore 交集并赋值")]),s._v(" "),e("li",[s._v("suion 并集")]),s._v(" "),e("li",[s._v("sdiff 差集")])]),s._v(" "),e("hr"),s._v(" "),e("h3",{attrs:{id:"_4-哈希-hash-键值对-key-value"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-哈希-hash-键值对-key-value"}},[s._v("#")]),s._v(" 4. 哈希（hash）键值对  key => value")]),s._v(" "),e("ul",[e("li",[s._v("hset 设置一个\n"),e("ul",[e("li",[s._v("hset hash key1 value1 -> (integer) 1")]),s._v(" "),e("li",[s._v("hset hash key2 value2 -> (integer) 1")]),s._v(" "),e("li",[s._v("hset hash key3 value3 -> (integer) 1")]),s._v(" "),e("li",[s._v("hset hash key1 value1 -> (integer) 0 已存在")])])]),s._v(" "),e("li",[s._v("hgetall 获取全部\n"),e("ul",[e("li",[s._v("hgetall hash"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key2"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value2"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key3"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value3"')]),s._v("\n")])])])])])]),s._v(" "),e("li",[s._v("hget 获取一个\n"),e("ul",[e("li",[s._v('hget hash key1 -> "value1"')])])]),s._v(" "),e("li",[s._v("hdel 删除\n"),e("ul",[e("li",[s._v("hdel hash key1 -> (integer) 1")]),s._v(" "),e("li",[s._v("hgetall hash"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key2"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value2"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key3"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value3"')]),s._v("\n")])])])])])]),s._v(" "),e("li",[s._v("hmset 设置多个")]),s._v(" "),e("li",[s._v("hmget 获取多个")]),s._v(" "),e("li",[s._v("hlen 个数")]),s._v(" "),e("li",[s._v("hexists 是否存在增长")]),s._v(" "),e("li",[s._v("hinrby 增长")]),s._v(" "),e("li",[s._v("hkeys 所有的key")]),s._v(" "),e("li",[s._v("hvals 所有的值")])]),s._v(" "),e("hr"),s._v(" "),e("h3",{attrs:{id:"_5-有序集合-zset-键值对-成员-分值-成员必须唯一"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-有序集合-zset-键值对-成员-分值-成员必须唯一"}},[s._v("#")]),s._v(" 5. 有序集合（zset）键值对  成员 => 分值 成员必须唯一")]),s._v(" "),e("ul",[e("li",[s._v("zadd 增加\n"),e("ul",[e("li",[s._v("zadd zset 100 item1 -> (integer) 1")]),s._v(" "),e("li",[s._v("zadd zset 200 item2 -> (integer) 1")]),s._v(" "),e("li",[s._v("zadd zset 300 item3 -> (integer) 1")]),s._v(" "),e("li",[s._v("zadd zset 100 item1 -> (integer) 0 已存在")])])]),s._v(" "),e("li",[s._v("zrange 按分值排序\n"),e("ul",[e("li",[s._v("zrange zset 0 -1 withscores"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item2"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item3"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"300"')]),s._v("\n")])])])])])]),s._v(" "),e("li",[s._v("zrangebyscore 按分值的一部分排序\n"),e("ul",[e("li",[s._v("zrangebyscore zset 0 200 withscores"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item2"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v("\n")])])])])])]),s._v(" "),e("li",[s._v("zrem 删除\n"),e("ul",[e("li",[s._v("zrem zset item1 -> (integer) 1")]),s._v(" "),e("li",[s._v("zrange zset 0 -1 withscores"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item2"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"item3"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"300"')]),s._v("\n")])])])])])]),s._v(" "),e("li",[s._v("zrank 排名升序")]),s._v(" "),e("li",[s._v("zremrangebyscore 按分值删除一部分")]),s._v(" "),e("li",[s._v("zremrangebyrank 按排名删除一部分")]),s._v(" "),e("li",[s._v("zcard 个数")])]),s._v(" "),e("h2",{attrs:{id:"六、redis事务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#六、redis事务"}},[s._v("#")]),s._v(" 六、redis事务")]),s._v(" "),e("h3",{attrs:{id:"mysql事务与redis事务比较"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql事务与redis事务比较"}},[s._v("#")]),s._v(" mysql事务与redis事务比较：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("比较")]),s._v(" "),e("th",[s._v("mysql")]),s._v(" "),e("th",[s._v("redis")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("开启")]),s._v(" "),e("td",[s._v("start transaction")]),s._v(" "),e("td",[s._v("multi")])]),s._v(" "),e("tr",[e("td",[s._v("语句")]),s._v(" "),e("td",[s._v("普通sql语句")]),s._v(" "),e("td",[s._v("普通redis命令")])]),s._v(" "),e("tr",[e("td",[s._v("失败")]),s._v(" "),e("td",[s._v("rollback")]),s._v(" "),e("td",[s._v("discard")])]),s._v(" "),e("tr",[e("td",[s._v("成功")]),s._v(" "),e("td",[s._v("commit")]),s._v(" "),e("td",[s._v("exec")])])])]),s._v(" "),e("p",[s._v("如果已经成功执行了2条语句, 第3条语句出错.")]),s._v(" "),e("p",[s._v("rollback后,前2条的语句影响消失.")]),s._v(" "),e("p",[s._v("discard只是结束本次事务,前2条语句造成的影响仍然还在")]),s._v(" "),e("h3",{attrs:{id:"悲观锁与乐观锁"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#悲观锁与乐观锁"}},[s._v("#")]),s._v(" 悲观锁与乐观锁")]),s._v(" "),e("p",[s._v("我正在买票"),e("code",[s._v("ticket -1 , money -100")]),s._v("而票只有1张, 如果在我multi之后,和exec之前, 票被别人买了,即ticket变成0了.我该如何观察这种情景,并不再提交")]),s._v(" "),e("p",[s._v("悲观的想法:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[s._v("世界充满危险,肯定有人和我抢, 给 ticket上锁, 只有我能操作. [悲观锁]\n")])])]),e("p",[s._v("乐观的想法:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[s._v("没有那么人和我抢,因此,我只需要注意,\n")])])]),e("p",[s._v("--有没有人更改ticket的值就可以了 [乐观锁]")]),s._v(" "),e("p",[s._v("Redis的事务中,启用的是乐观锁,只负责监测key没有被改动")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("\n具体的命令----  watch命令\n\nredis "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" ticket\nOK\nredis "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\nredis "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" decr ticket\nQUEUED\nredis "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" decrby money "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nQUEUED\nredis "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nil"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   // 返回nil,说明监视的ticket已经改变了,事务就取消了.\nredis "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get ticket\n"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\nredis "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get money\n"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" key1 key2  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". keyN\n作用:监听key1 key2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("keyN有没有变化,如果有变, 则事务取消\n\nunwatch\n作用: 取消所有watch监听\n\n")])])]),e("h2",{attrs:{id:"七、发布订阅"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七、发布订阅"}},[s._v("#")]),s._v(" 七、发布订阅")]),s._v(" "),e("p",[s._v("订阅端: subscribe 频道名称")]),s._v(" "),e("p",[s._v("发布端: publish 频道名称 发布内容")]),s._v(" "),e("h2",{attrs:{id:"八、持久化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#八、持久化"}},[s._v("#")]),s._v(" 八、持久化")]),s._v(" "),e("h3",{attrs:{id:"redis-快照rdb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-快照rdb"}},[s._v("#")]),s._v(" redis 快照rdb")]),s._v(" "),e("p",[s._v("有限制，还是容易数据丢失，恢复快")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("\nsave "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("900")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 900内,有1条写入,则产生快照 ")]),s._v("\nsave "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果300秒内有1000次写入,则产生快照")]),s._v("\nsave "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果60秒内有10000次写入,则产生快照")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("这3个选项都屏蔽,则rdb禁用"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nstop-writes-on-bgsave-error "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台备份进程出错时,主进程停不停止写入?")]),s._v("\nrdbcompression "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出的rdb文件是否压缩")]),s._v("\nRdbchecksum   "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入rbd恢复时数据时,要不要检验rdb的完整性")]),s._v("\ndbfilename dump.rdb  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出来的rdb文件名")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" ./  //rdb的放置路径\n\n")])])]),e("h3",{attrs:{id:"redis-日志aof"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-日志aof"}},[s._v("#")]),s._v(" redis 日志aof")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("\nappendonly no "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否打开 aof日志功能")]),s._v("\n\nappendfsync always   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每1个命令,都立即同步到aof. 安全,速度慢")]),s._v("\nappendfsync everysec "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 折衷方案,每秒写1次")]),s._v("\nappendfsync no      "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入工作交给操作系统,由操作系统判断缓冲区大小,统一写入到aof. 同步频率低,速度快,")]),s._v("\n\n\nno-appendfsync-on-rewrite  yes: "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正在导出rdb快照的过程中,要不要停止同步aof")]),s._v("\nauto-aof-rewrite-percentage "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#aof文件大小比起上次重写时的大小,增长率100%时,重写")]),s._v("\nauto-aof-rewrite-min-size 64mb "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#aof文件,至少超过64M时,重写")]),s._v("\n")])])]),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[s._v("注: 在dump rdb过程中,aof如果停止同步,会不会丢失?\n答: 不会,所有的操作缓存在内存的队列里, dump完成后,统一操作.\n\n注: aof重写是指什么?\n答: aof重写是指把内存中的数据,逆化成命令,写入到.aof日志里.以解决 aof日志过大的问题.\n\n问: 如果rdb文件,和aof文件都存在,优先用谁来恢复数据?\n答: aof\n\n问: 2种是否可以同时用?\n答: 可以,而且推荐这么做\n\n问: 恢复时rdb和aof哪个恢复的快\n答: rdb快,因为其是数据的内存映射,直 接载入到内存,而aof是命令,需要逐条执行\n")])])]),e("h2",{attrs:{id:"九、redis主从复制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#九、redis主从复制"}},[s._v("#")]),s._v(" 九、redis主从复制")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("Master配置:\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":关闭rdb快照"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("备份工作交给slave"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":可以开启aof\n\nslave配置:\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": 声明slave-of\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": 配置密码"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("如果master有密码"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("某1个"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("slave打开 rdb快照功能\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(": 配置是否只读"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("slave-read-only"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\n")])])]),e("h2",{attrs:{id:"十、redis表设计"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#十、redis表设计"}},[s._v("#")]),s._v(" 十、redis表设计")]),s._v(" "),e("p",[s._v("主键表")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("列名")]),s._v(" "),e("th",[s._v("操作")]),s._v(" "),e("th",[s._v("备注")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("global:user_id")]),s._v(" "),e("td",[s._v("incr")]),s._v(" "),e("td",[s._v("全局user_id")])]),s._v(" "),e("tr",[e("td",[s._v("global:post_id")]),s._v(" "),e("td",[s._v("incr")]),s._v(" "),e("td",[s._v("全局post_id")])])])]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("mysql用户表")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("列名")]),s._v(" "),e("th",[s._v("操作")]),s._v(" "),e("th",[s._v("备注")]),s._v(" "),e("th")])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("user_id")]),s._v(" "),e("td",[s._v("user_name")]),s._v(" "),e("td",[s._v("password")]),s._v(" "),e("td",[s._v("authsecret")])]),s._v(" "),e("tr",[e("td",[s._v("1")]),s._v(" "),e("td",[s._v("shengj")]),s._v(" "),e("td",[s._v("123456")]),s._v(" "),e("td",[s._v(",./!@#")])])])]),s._v(" "),e("p",[s._v("redis用户表")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("列名")]),s._v(" "),e("th",[s._v("操作")]),s._v(" "),e("th",[s._v("备注")]),s._v(" "),e("th")])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("user:user_id")]),s._v(" "),e("td",[s._v("user:user_id:*:user_name")]),s._v(" "),e("td",[s._v("user:user_id:*:password")]),s._v(" "),e("td",[s._v("user:user_id:*:authsecret")])]),s._v(" "),e("tr",[e("td",[s._v("1")]),s._v(" "),e("td",[s._v("shengj")]),s._v(" "),e("td",[s._v("123456")]),s._v(" "),e("td",[s._v(",./!@#")])])])]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("mysql发送表")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("列名")]),s._v(" "),e("th",[s._v("操作")]),s._v(" "),e("th",[s._v("备注")]),s._v(" "),e("th"),s._v(" "),e("th")])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("post_id")]),s._v(" "),e("td",[s._v("user_id")]),s._v(" "),e("td",[s._v("user_name")]),s._v(" "),e("td",[s._v("time")]),s._v(" "),e("td",[s._v("content")])]),s._v(" "),e("tr",[e("td",[s._v("1")]),s._v(" "),e("td",[s._v("1")]),s._v(" "),e("td",[s._v("shengj")]),s._v(" "),e("td",[s._v("1370987654")]),s._v(" "),e("td",[s._v("测试内容")])])])]),s._v(" "),e("p",[s._v("redis发送表")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("列名")]),s._v(" "),e("th",[s._v("操作")]),s._v(" "),e("th",[s._v("备注")]),s._v(" "),e("th"),s._v(" "),e("th")])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("post:post_id")]),s._v(" "),e("td",[s._v("post:post_id:*:user_id")]),s._v(" "),e("td",[s._v("post:post_id:*:user_name")]),s._v(" "),e("td",[s._v("post:post_id:*:time")]),s._v(" "),e("td",[s._v("post:post_id:*:content")])]),s._v(" "),e("tr",[e("td",[s._v("1")]),s._v(" "),e("td",[s._v("1")]),s._v(" "),e("td",[s._v("shengj")]),s._v(" "),e("td",[s._v("1370987654")]),s._v(" "),e("td",[s._v("测试内容")])])])]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("关注表：following  -> set user_id")]),s._v(" "),e("p",[s._v("粉丝表：follower -> set user_id")]),s._v(" "),e("p",[s._v("推送表：receivepost -> list user_ids")]),s._v(" "),e("p",[s._v("拉取表：pullpost -> zset user_ids")]),s._v(" "),e("h2",{attrs:{id:"十一、面试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#十一、面试"}},[s._v("#")]),s._v(" 十一、面试")]),s._v(" "),e("h3",{attrs:{id:"_1、缓存雪崩"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、缓存雪崩"}},[s._v("#")]),s._v(" 1、缓存雪崩")]),s._v(" "),e("p",[s._v("问题：当我们的缓存失效或者redis挂了，那么这个时候的请求都会直接走数据库，就会给数据库造成极大的压力，导致数据库也挂了")]),s._v(" "),e("p",[s._v("解决：")]),s._v(" "),e("ol",[e("li",[s._v("对缓存设置不同的过期时间，这样就不会导致缓存同时失效")]),s._v(" "),e("li",[s._v("建立redis集群，保证服务的可靠性")])]),s._v(" "),e("h3",{attrs:{id:"_2、缓存穿透"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、缓存穿透"}},[s._v("#")]),s._v(" 2、缓存穿透")]),s._v(" "),e("p",[s._v("问题：当有大量用户不走我们设置的键值，就会直接走数据库，就会给数据库造成极大的压力，导致数据库也挂了")]),s._v(" "),e("p",[s._v("解决：")]),s._v(" "),e("ol",[e("li",[s._v("参数过滤和提醒，引导用户走我们的设置的键值")]),s._v(" "),e("li",[s._v("对不合法的参数进行空对象缓存，并设置较短的过期时间")])]),s._v(" "),e("h3",{attrs:{id:"_3、缓存与数据库读写一致"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、缓存与数据库读写一致"}},[s._v("#")]),s._v(" 3、缓存与数据库读写一致")]),s._v(" "),e("p",[s._v("问题：如果一直是读的话，是没问题的，但是更新操作会导致数据库已经更新了，缓存还是旧的数据")]),s._v(" "),e("p",[s._v("解决：")]),s._v(" "),e("p",[s._v("并发下解决数据库与缓存不一致的思路：将删除缓存、修改数据库、读取缓存等的操作积压到队列里边，实现串行化。")]),s._v(" "),e("ul",[e("li",[s._v("先删除缓存，再更新数据库")])]),s._v(" "),e("p",[s._v("在高并发下表现不如意，在原子性被破坏时表现优异")]),s._v(" "),e("ul",[e("li",[s._v("先更新数据库，再删除缓存(Cache Aside Pattern设计模式)")])]),s._v(" "),e("p",[s._v("在高并发下表现优异，在原子性被破坏时表现不如意")]),s._v(" "),e("h2",{attrs:{id:"docker实现redis主从"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker实现redis主从"}},[s._v("#")]),s._v(" docker实现redis主从")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/OMGZui/redis_m_s",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker实现redis主从"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"_1、命令行模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、命令行模式"}},[s._v("#")]),s._v(" 1、命令行模式")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取redis")]),s._v("\ndocker pull redis\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主")]),s._v("\ndocker run -v "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("/master/redis.conf:/usr/local/etc/redis/redis.conf --name redis-master redis redis-server /usr/local/etc/redis/redis.conf\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从1 --link redis-master:master master是别名")]),s._v("\ndocker run -v "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("/slave1/redis.conf:/usr/local/etc/redis/redis.conf --name redis-slave1 --link redis-master:master redis redis-server /usr/local/etc/redis/redis.conf\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从2")]),s._v("\ndocker run -v "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("/slave2/redis.conf:/usr/local/etc/redis/redis.conf --name redis-slave2 --link redis-master:master redis redis-server /usr/local/etc/redis/redis.conf\n\n")])])]),e("h3",{attrs:{id:"_2、docker-compose模式-推荐"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、docker-compose模式-推荐"}},[s._v("#")]),s._v(" 2、docker-compose模式 推荐")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取redis")]),s._v("\ndocker pull redis\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目录")]),s._v("\n├── docker-compose.yml\n├── master\n│   ├── Dockerfile\n│   └── redis.conf\n├── redis.conf\n├── slave1\n│   ├── Dockerfile\n│   └── redis.conf\n└── slave2\n    ├── Dockerfile\n    └── redis.conf\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\ndocker-compose up -d master slave1 slave2\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看主容器")]),s._v("\ndocker-compose "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" master "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nroot@cab5db8d544b:/data"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" info Replication\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Replication")]),s._v("\nrole:master\nconnected_slaves:2\nslave0:ip"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.23")]),s._v(".0.3,port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(",state"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("online,offset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1043")]),s._v(",lag"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nslave1:ip"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.23")]),s._v(".0.4,port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(",state"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("online,offset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1043")]),s._v(",lag"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmaster_replid:995257c6b5ac62f7908cc2c7bb770f2f17b60401\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:1043\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:1043\n")])])]),e("h2",{attrs:{id:"十二、参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#十二、参考资料"}},[s._v("#")]),s._v(" 十二、参考资料")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("redis"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://lw900925.github.io/docker/docker-redis-cluster.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker：创建Redis集群"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);